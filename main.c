/**
  ******************************************************************************
  * @file    TIM_PWM_Output/main.c 
  * @author  bermerlin@gmail.com
  * @version V1.0
  * @date    15-March-2013
  * @brief   Main program body
  ******************************************************************************
  */ 

/* Includes ------------------------------------------------------------------*/
#include "stm32f4_discovery.h"

/* Private typedef -----------------------------------------------------------*/
/* Private define ------------------------------------------------------------*/
/* Private macro -------------------------------------------------------------*/
/* Private variables ---------------------------------------------------------*/

__IO uint32_t line_number = 0;
__IO uint16_t toggle = 0;
__IO uint32_t letsgo = 0;
uint32_t fbad;
uint32_t bmadd;
uint32_t fbuf[2064];
uint32_t a, b, c, d, slices, fmode, r, teemp, correction, test;
uint32_t number0, number1, number2;

uint8_t __attribute__ ((aligned)) USART_Buffer_Rx0[80];
uint8_t __attribute__ ((aligned)) USART_Buffer_Rx1[80];

FlagStatus flag;
uint32_t m_index;
uint8_t buf_nmea[200];
uint8_t temprec;
uint32_t idx;

// one
const uint8_t one_rle[704] = {
		1,1,191,1,191,1,191,1,191,1,166,2,189,5,187,6,185,9,182,11,181,12,179,14,177,16,176,17,174,19,172,21,
		171,22,169,23,168,25,167,26,165,27,164,29,163,29,162,31,160,32,160,33,158,34,157,36,156,36,155,37,154,38,154,39,
		152,40,151,41,151,41,150,42,149,43,149,43,148,44,148,44,147,45,146,46,146,46,145,47,144,48,144,48,143,49,142,50,
		142,50,141,51,140,52,140,52,140,52,140,52,139,53,139,53,139,53,139,53,139,53,139,53,139,53,139,53,139,53,139,53,
		139,53,139,53,138,54,138,54,138,54,138,54,138,54,138,54,138,54,138,54,138,54,138,54,138,54,137,55,137,55,137,55,
		137,55,137,55,137,55,137,55,137,55,137,55,137,55,137,55,136,56,136,55,137,55,137,55,137,55,137,55,137,55,137,55,
		137,55,137,55,137,55,137,55,137,55,136,56,136,56,136,56,136,56,136,56,136,56,136,56,136,56,136,56,136,56,136,56,
		135,57,135,57,135,57,135,57,135,57,135,57,135,57,135,57,135,57,135,56,136,56,136,56,135,57,135,57,135,57,135,57,
		135,57,135,57,135,57,135,57,135,57,135,57,134,57,135,57,135,57,135,57,135,56,136,56,136,56,137,55,142,49,146,46,
		149,42,152,40,154,38,156,35,159,33,160,31,163,29,164,27,167,24,169,23,170,21,173,19,174,17,176,15,178,14,179,12,
		181,10,183,8,185,7,186,5,19,1,168,3,20,1,191,1,191,1,191,1,191,1,191,1,191,1,191,1,191,1,191,1,
		191,1,191,1,191,1,191,1,191,1,168,2,189,3,188,5,186,7,184,8,182,11,180,12,179,14,177,15,175,18,173,19,
		171,22,169,23,167,26,165,27,163,29,161,32,158,34,156,36,154,39,151,41,148,44,146,46,142,50,137,56,136,56,136,56,
		136,56,135,57,135,57,135,57,135,57,135,57,135,57,135,57,135,57,135,57,135,57,135,57,134,57,135,57,135,57,135,57,
		135,57,135,57,135,57,135,56,136,56,136,56,135,57,135,57,135,57,135,57,135,56,136,56,136,56,136,56,136,56,136,56,
		136,56,136,55,136,56,136,56,136,56,136,56,136,56,136,56,136,56,136,55,137,55,137,55,137,55,137,55,137,55,136,55,
		137,55,137,55,137,55,137,55,137,55,137,55,137,55,137,54,138,54,138,54,138,54,137,55,137,55,137,55,137,54,138,54,
		138,54,138,54,138,54,138,54,138,54,137,55,137,54,138,54,138,54,138,54,138,54,138,54,138,53,139,53,139,53,139,53,
		139,53,139,53,138,54,138,53,139,53,139,53,139,53,139,53,139,53,140,52,140,51,142,50,142,50,143,49,143,49,144,48,
		144,48,145,46,146,46,147,45,147,45,148,43,149,43,150,42,150,41,152,40,152,40,153,38,154,38,155,36,156,36,157,34,
		158,34,159,32,160,31,162,30,162,29,164,27,165,27,166,25,167,24,169,22,170,21,171,20,173,18,174,17,176,15,177,14,
		179,11,181,10,183,7,185,6,48,1,138,3,50,1,191,1,191,1,191,1,191,1,191,1,191,191,191,191,191,191,191,0
};

// two
const uint8_t two_rle[896] = {
		63,96,92,101,88,103,86,105,85,107,10,2,71,108,10,5,68,108,11,6,66,109,10,9,64,108,10,11,64,106,11,12,
		65,104,10,14,64,103,10,16,64,102,10,17,64,100,10,19,64,98,10,21,64,96,11,22,64,95,10,23,65,93,10,25,
		65,92,10,26,65,90,10,27,66,88,10,29,66,87,10,29,67,85,10,31,67,83,10,32,68,82,10,33,67,81,10,34,
		68,79,10,36,68,78,10,36,69,76,10,37,70,74,10,38,71,73,10,39,71,71,10,40,72,69,10,41,73,68,10,41,
		74,66,10,42,75,64,10,43,76,63,10,43,77,61,10,44,78,59,11,44,78,59,10,45,79,57,10,46,80,55,11,46,
		81,54,10,47,82,52,10,48,83,50,11,48,143,49,142,50,142,50,141,51,140,52,140,52,140,52,140,52,139,53,139,53,
		139,53,139,53,139,53,139,53,139,53,139,53,139,53,139,53,139,53,139,53,138,54,138,54,138,54,138,54,138,54,138,54,
		138,54,138,54,138,54,138,54,138,54,137,55,137,55,137,55,137,55,137,55,137,55,137,55,137,55,137,55,137,55,137,55,
		136,56,136,55,137,55,137,55,137,55,137,55,137,55,137,55,137,55,137,55,137,55,137,55,137,55,136,56,136,56,136,56,
		136,56,136,56,136,56,136,56,136,56,136,56,136,56,136,56,135,57,135,57,135,57,135,57,135,57,135,57,135,57,135,57,
		135,57,135,56,136,56,136,56,135,57,135,57,135,57,135,57,135,57,135,57,135,57,135,57,135,57,135,57,134,57,135,57,
		135,57,135,57,135,56,136,56,136,56,137,55,142,49,146,46,149,42,152,40,154,38,156,35,159,33,160,31,73,71,19,29,
		70,77,17,27,68,82,17,24,67,86,16,23,65,90,15,21,64,94,15,19,62,97,15,17,61,101,14,15,61,104,13,14,
		59,107,13,12,59,109,13,10,58,113,12,8,58,115,12,7,56,118,12,5,56,120,12,3,56,122,68,125,66,127,64,130,
		61,131,60,133,58,135,56,136,56,135,58,133,60,131,62,129,64,127,66,124,56,1,12,122,56,3,12,120,56,5,13,116,
		57,7,13,114,57,9,13,112,58,10,13,109,59,12,14,105,60,14,14,103,61,16,14,99,62,18,14,96,63,20,15,92,
		65,21,16,88,66,24,16,84,67,26,17,80,69,28,18,74,71,30,21,66,75,32,159,34,158,36,155,39,153,41,151,44,
		147,47,145,51,140,56,136,56,136,56,135,57,135,57,135,57,135,57,135,56,135,57,135,57,135,57,135,57,135,57,135,57,
		135,57,135,57,135,57,135,57,135,57,135,56,136,56,136,56,136,56,136,56,136,56,135,57,135,57,135,57,135,57,135,57,
		135,57,135,57,135,56,136,56,136,56,136,56,136,56,136,56,136,56,136,56,136,56,136,56,136,56,136,55,137,55,137,55,
		137,55,137,55,137,55,137,55,137,55,137,55,137,55,137,55,137,54,138,54,138,54,137,55,137,55,137,55,137,55,137,55,
		137,55,137,55,137,55,137,55,137,54,138,54,138,54,138,54,138,54,138,54,138,54,138,54,138,54,138,54,138,54,138,54,
		138,54,138,53,139,53,139,53,139,53,139,53,139,53,139,53,139,53,139,53,138,54,138,52,140,50,142,48,144,46,146,44,
		148,41,151,39,153,37,20,52,83,35,20,55,82,33,20,57,82,31,20,60,81,29,20,62,81,27,19,66,80,24,20,68,
		80,22,20,71,79,20,20,73,80,17,20,76,79,15,20,78,79,13,20,81,78,11,19,84,78,9,19,87,78,6,19,89,
		78,3,20,92,98,94,96,97,93,99,91,102,87,105,85,108,82,110,80,113,77,115,77,116,77,115,78,115,77,115,78,115,
		78,114,79,114,78,114,79,114,79,113,80,112,82,111,82,110,83,110,84,108,86,107,87,105,89,104,92,100,61,192,192,192,
		192,192,192,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
};

// three
const uint8_t three_rle[928] = {
		63,96,92,101,88,103,86,105,85,107,10,2,71,108,10,5,68,108,11,6,66,109,10,9,64,108,10,11,64,106,11,12,
		65,104,10,14,64,103,10,16,64,102,10,17,64,100,10,19,64,98,10,21,64,96,11,22,64,95,10,23,65,93,10,25,
		65,92,10,26,65,90,10,27,66,88,10,29,66,87,10,29,67,85,10,31,67,83,10,32,68,82,10,33,67,81,10,34,
		68,79,10,36,68,78,10,36,69,76,10,37,70,74,10,38,71,73,10,39,71,71,10,40,72,69,10,41,73,68,10,41,
		74,66,10,42,75,64,10,43,76,63,10,43,77,61,10,44,78,59,11,44,78,59,10,45,79,57,10,46,80,55,11,46,
		81,54,10,47,82,52,10,48,83,50,11,48,143,49,142,50,142,50,141,51,140,52,140,52,140,52,140,52,139,53,139,53,
		139,53,139,53,139,53,139,53,139,53,139,53,139,53,139,53,139,53,139,53,138,54,138,54,138,54,138,54,138,54,138,54,
		138,54,138,54,138,54,138,54,138,54,137,55,137,55,137,55,137,55,137,55,137,55,137,55,137,55,137,55,137,55,137,55,
		136,56,136,55,137,55,137,55,137,55,137,55,137,55,137,55,137,55,137,55,137,55,137,55,137,55,136,56,136,56,136,56,
		136,56,136,56,136,56,136,56,136,56,136,56,136,56,136,56,135,57,135,57,135,57,135,57,135,57,135,57,135,57,135,57,
		135,57,135,56,136,56,136,56,135,57,135,57,135,57,135,57,135,57,135,57,135,57,135,57,135,57,135,57,134,57,135,57,
		135,57,135,57,135,56,136,56,136,56,137,55,142,49,146,46,149,42,152,40,154,38,156,35,159,33,160,31,73,71,19,29,
		70,77,17,27,68,82,17,24,67,86,16,23,65,90,15,21,64,94,15,19,62,97,15,17,61,101,14,15,61,104,13,14,
		59,107,13,12,59,109,13,10,58,113,12,8,58,115,12,7,56,118,12,5,56,120,12,3,56,122,68,125,66,127,64,130,
		61,131,60,133,58,135,56,136,56,135,58,133,60,131,62,129,64,127,66,124,69,122,13,2,56,120,13,3,58,116,14,5,
		58,114,14,7,58,112,14,8,59,109,14,11,60,105,15,12,61,103,15,14,62,99,16,15,63,96,16,18,64,92,17,19,
		66,88,17,22,67,84,18,23,69,80,18,26,71,74,20,27,75,66,22,29,161,32,158,34,156,36,154,39,151,41,148,44,
		146,46,142,50,137,56,136,56,136,56,136,56,135,57,135,57,135,57,135,57,135,57,135,57,135,57,135,57,135,57,135,57,
		135,57,134,57,135,57,135,57,135,57,135,57,135,57,135,57,135,56,136,56,136,56,135,57,135,57,135,57,135,57,135,56,
		136,56,136,56,136,56,136,56,136,56,136,56,136,55,136,56,136,56,136,56,136,56,136,56,136,56,136,56,136,55,137,55,
		137,55,137,55,137,55,137,55,136,55,137,55,137,55,137,55,137,55,137,55,137,55,137,55,137,54,138,54,138,54,138,54,
		137,55,137,55,137,55,137,54,138,54,138,54,138,54,138,54,138,54,138,54,137,55,137,54,138,54,138,54,138,54,138,54,
		138,54,138,53,139,53,139,53,139,53,139,53,139,53,138,54,138,53,139,53,139,53,139,53,139,53,139,53,140,52,140,51,
		142,50,142,50,81,52,10,49,79,55,9,49,77,57,10,48,75,60,9,48,73,62,10,46,71,66,9,46,69,68,10,45,
		67,71,9,45,65,73,10,43,64,76,9,43,62,78,10,42,60,81,9,41,58,84,10,40,56,87,9,40,54,89,10,38,
		53,92,9,38,51,94,10,36,50,97,9,36,48,99,10,34,47,102,9,34,44,105,10,32,43,108,9,31,42,110,10,30,
		40,113,9,29,39,115,10,27,40,116,9,27,41,115,10,25,43,115,9,24,44,115,10,22,46,115,9,21,48,114,9,20,
		50,114,9,18,51,114,9,17,53,114,9,15,55,113,9,14,57,112,10,11,61,111,9,10,63,110,10,7,66,110,9,6,
		69,108,10,3,73,107,87,105,89,104,92,100,61,192,192,192,192,192,192,0,0,0,0,0,0,0,0,0,0,0,0,0

};

// four
const uint8_t four_rle[1088] = {
		1,1,191,1,191,1,191,1,191,1,166,2,189,5,187,6,185,9,182,11,181,12,179,14,177,16,176,17,51,2,121,19,
		49,4,119,21,47,5,119,22,45,7,117,23,44,9,115,25,42,11,114,26,40,13,112,27,40,14,110,29,38,16,109,29,
		37,18,107,31,36,19,105,32,35,21,104,33,33,23,102,34,33,24,100,36,31,26,99,36,31,27,97,37,30,29,95,38,
		30,29,95,39,28,31,93,40,28,32,91,41,28,33,90,41,27,35,88,42,27,36,86,43,27,37,85,43,26,39,83,44,
		26,40,82,44,26,41,80,45,26,42,78,46,25,44,77,46,25,45,75,47,25,46,73,48,25,47,72,48,25,48,70,49,
		25,48,69,50,25,49,68,50,25,50,66,51,24,52,64,52,24,53,63,52,24,53,63,52,24,53,63,52,24,53,62,53,
		24,53,62,53,23,54,62,53,23,54,62,53,23,54,62,53,23,53,63,53,23,53,63,53,23,53,63,53,23,53,63,53,
		23,53,63,53,22,54,63,53,22,54,63,53,22,54,62,54,22,54,62,54,22,54,62,54,22,54,62,54,22,53,63,54,
		21,54,63,54,21,54,63,54,21,54,63,54,21,54,63,54,21,54,63,54,21,54,63,54,21,54,62,55,20,55,62,55,
		20,55,62,55,20,55,62,55,20,55,62,55,20,55,62,55,20,54,63,55,20,54,63,55,19,55,63,55,19,55,63,55,
		19,55,63,55,19,55,62,56,19,55,62,55,20,55,62,55,20,55,62,55,20,55,62,55,19,56,62,55,19,56,62,55,
		19,55,63,55,19,55,63,55,19,55,63,55,19,55,63,55,19,55,63,55,18,56,63,55,18,56,62,56,18,56,62,56,
		18,56,62,56,18,56,62,56,18,56,62,56,18,55,63,56,17,56,63,56,17,56,63,56,17,56,63,56,17,56,63,56,
		17,56,63,56,17,56,62,57,17,56,62,57,16,57,62,57,16,57,62,57,16,57,62,57,16,56,63,57,16,56,63,57,
		16,56,63,57,16,56,63,57,15,57,63,56,16,57,63,56,16,57,63,56,16,57,62,57,16,57,62,57,16,57,62,57,
		16,57,62,57,16,57,62,57,15,57,63,57,15,57,63,57,15,57,63,57,15,57,63,57,15,57,63,57,15,57,62,57,
		16,57,62,57,16,57,62,57,16,57,62,57,16,57,62,56,17,57,62,56,18,56,62,56,18,54,65,55,18,48,76,49,
		19,45,82,46,19,43,87,42,21,39,92,40,21,37,96,38,21,35,100,35,22,33,104,33,23,30,107,31,24,28,21,71,
		19,29,24,27,19,77,17,27,26,24,18,82,17,24,27,23,17,86,16,23,28,20,17,90,15,21,29,19,16,94,15,19,
		30,16,16,97,15,17,31,15,15,101,14,15,33,13,15,104,13,14,33,11,15,107,13,12,35,9,15,109,13,10,36,8,
		14,113,12,8,38,6,14,115,12,7,39,4,13,118,12,5,40,3,13,120,12,3,56,122,68,125,66,127,64,130,61,131,
		60,133,58,135,56,136,56,135,58,133,60,131,62,129,64,127,66,124,69,122,13,2,56,120,13,3,58,116,14,5,58,114,
		14,7,58,112,14,8,59,109,14,11,60,105,15,12,61,103,15,14,62,99,16,15,63,96,16,18,64,92,17,19,66,88,
		17,22,67,84,18,23,69,80,18,26,71,74,20,27,75,66,22,29,161,32,158,34,156,36,154,39,151,41,148,44,146,46,
		142,50,137,56,136,56,136,56,136,56,135,57,135,57,135,57,135,57,135,57,135,57,135,57,135,57,135,57,135,57,135,57,
		134,57,135,57,135,57,135,57,135,57,135,57,135,57,135,56,136,56,136,56,135,57,135,57,135,57,135,57,135,56,136,56,
		136,56,136,56,136,56,136,56,136,56,136,55,136,56,136,56,136,56,136,56,136,56,136,56,136,56,136,55,137,55,137,55,
		137,55,137,55,137,55,136,55,137,55,137,55,137,55,137,55,137,55,137,55,137,55,137,54,138,54,138,54,138,54,137,55,
		137,55,137,55,137,54,138,54,138,54,138,54,138,54,138,54,138,54,137,55,137,54,138,54,138,54,138,54,138,54,138,54,
		138,53,139,53,139,53,139,53,139,53,139,53,138,54,138,53,139,53,139,53,139,53,139,53,139,53,140,52,140,51,142,50,
		142,50,143,49,143,49,144,48,144,48,145,46,146,46,147,45,147,45,148,43,149,43,150,42,150,41,152,40,152,40,153,38,
		154,38,155,36,156,36,157,34,158,34,159,32,160,31,162,30,162,29,164,27,165,27,166,25,167,24,169,22,170,21,171,20,
		173,18,174,17,176,15,177,14,179,11,181,10,183,7,185,6,48,1,138,3,50,1,191,1,191,1,191,1,191,1,191,1,
		191,192,192,192,192,192,192,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
};

// five
const uint8_t five_rle[928] = {
		63,96,92,101,88,103,86,105,85,107,83,108,83,108,83,109,83,108,85,106,88,104,88,103,90,102,78,2,11,100,78,4,
		11,98,78,5,12,96,78,7,12,95,77,9,12,93,77,11,12,92,76,13,12,90,77,14,12,88,77,16,12,87,76,18,
		12,85,77,19,12,83,77,21,12,82,76,23,11,81,77,24,11,79,77,26,11,78,77,27,11,76,77,29,11,74,78,29,
		12,73,77,31,12,71,78,32,12,69,79,33,12,68,78,35,12,66,79,36,12,64,80,37,12,63,79,39,12,61,80,40,
		12,59,81,41,11,59,81,42,11,57,81,44,11,55,82,45,11,54,82,46,11,52,83,47,11,50,84,48,144,48,144,49,
		143,50,141,52,140,53,139,53,139,53,139,53,139,53,138,54,138,54,138,54,138,53,139,53,139,53,139,53,139,53,138,54,
		138,54,138,54,138,54,138,54,138,54,138,53,138,54,138,54,138,54,138,54,138,54,138,54,138,54,137,55,137,55,137,55,
		137,55,137,55,137,54,138,54,137,55,137,55,137,55,137,55,137,55,137,55,137,55,137,55,136,56,136,56,136,55,137,55,
		137,55,137,55,137,55,136,56,136,56,136,56,136,56,136,56,136,56,136,55,136,56,136,56,136,56,136,56,136,56,136,56,
		136,56,135,57,135,57,135,57,135,56,136,56,136,56,136,56,135,57,135,57,135,57,135,57,135,57,135,57,135,57,135,57,
		134,57,135,57,135,57,135,57,135,57,135,57,135,57,135,57,135,57,135,57,135,57,136,56,136,54,138,48,144,45,147,43,
		150,39,153,37,155,35,157,33,160,30,162,28,21,71,72,27,19,77,70,24,18,82,68,23,17,86,67,20,17,90,65,19,
		16,94,64,16,16,97,63,15,15,101,62,13,15,104,60,11,15,107,60,9,15,109,59,8,14,113,58,6,14,115,58,4,
		13,118,57,3,13,120,71,122,68,125,66,127,64,130,61,131,60,133,58,135,56,136,56,135,58,133,60,131,62,129,64,127,
		66,124,69,122,13,2,56,120,13,3,58,116,14,5,58,114,14,7,58,112,14,8,59,109,14,11,60,105,15,12,61,103,
		15,14,62,99,16,15,63,96,16,18,64,92,17,19,66,88,17,22,67,84,18,23,69,80,18,26,71,74,20,27,75,66,
		22,29,161,32,158,34,156,36,154,39,151,41,148,44,146,46,142,50,137,56,136,56,136,56,136,56,135,57,135,57,135,57,
		135,57,135,57,135,57,135,57,135,57,135,57,135,57,135,57,134,57,135,57,135,57,135,57,135,57,135,57,135,57,135,56,
		136,56,136,56,135,57,135,57,135,57,135,57,135,56,136,56,136,56,136,56,136,56,136,56,136,56,136,55,136,56,136,56,
		136,56,136,56,136,56,136,56,136,56,136,55,137,55,137,55,137,55,137,55,137,55,136,55,137,55,137,55,137,55,137,55,
		137,55,137,55,137,55,137,54,138,54,138,54,138,54,137,55,137,55,137,55,137,54,138,54,138,54,138,54,138,54,138,54,
		138,54,137,55,137,54,138,54,138,54,138,54,138,54,138,54,138,53,139,53,139,53,139,53,139,53,139,53,138,54,138,53,
		139,53,139,53,139,53,139,53,139,53,140,52,140,51,142,50,142,50,81,52,10,49,79,55,9,49,77,57,10,48,75,60,
		9,48,73,62,10,46,71,66,9,46,69,68,10,45,67,71,9,45,65,73,10,43,64,76,9,43,62,78,10,42,60,81,
		9,41,58,84,10,40,56,87,9,40,54,89,10,38,53,92,9,38,51,94,10,36,50,97,9,36,48,99,10,34,47,102,
		9,34,44,105,10,32,43,108,9,31,42,110,10,30,40,113,9,29,39,115,10,27,40,116,9,27,41,115,10,25,43,115,
		9,24,44,115,10,22,46,115,9,21,48,114,9,20,50,114,9,18,51,114,9,17,53,114,9,15,55,113,9,14,57,112,
		10,11,61,111,9,10,63,110,10,7,66,110,9,6,69,108,10,3,73,107,87,105,89,104,92,100,61,192,192,192,192,192,
		192,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
};

// six
const uint8_t six_rle[1184] = {
		63,96,92,101,88,103,86,105,85,107,83,108,83,108,83,109,83,108,85,106,88,104,88,103,90,102,78,2,11,100,78,4,
		11,98,78,5,12,96,78,7,12,95,77,9,12,93,77,11,12,92,76,13,12,90,77,14,12,88,77,16,12,87,76,18,
		12,85,77,19,12,83,77,21,12,82,76,23,11,81,77,24,11,79,77,26,11,78,77,27,11,76,77,29,11,74,78,29,
		12,73,77,31,12,71,78,32,12,69,79,33,12,68,78,35,12,66,79,36,12,64,80,37,12,63,79,39,12,61,80,40,
		12,59,81,41,11,59,81,42,11,57,81,44,11,55,82,45,11,54,82,46,11,52,83,47,11,50,84,48,144,48,144,49,
		143,50,141,52,140,53,139,53,139,53,139,53,139,53,138,54,138,54,138,54,138,53,139,53,139,53,139,53,139,53,138,54,
		138,54,138,54,138,54,138,54,138,54,138,53,138,54,138,54,138,54,138,54,138,54,138,54,138,54,137,55,137,55,137,55,
		137,55,137,55,137,54,138,54,137,55,137,55,137,55,137,55,137,55,137,55,137,55,137,55,136,56,136,56,136,55,137,55,
		137,55,137,55,137,55,136,56,136,56,136,56,136,56,136,56,136,56,136,55,136,56,136,56,136,56,136,56,136,56,136,56,
		136,56,135,57,135,57,135,57,135,56,136,56,136,56,136,56,135,57,135,57,135,57,135,57,135,57,135,57,135,57,135,57,
		134,57,135,57,135,57,135,57,135,57,135,57,135,57,135,57,135,57,135,57,135,57,136,56,136,54,138,48,144,45,147,43,
		150,39,153,37,155,35,157,33,160,30,162,28,21,71,72,27,19,77,70,24,18,82,68,23,17,86,67,20,17,90,65,19,
		16,94,64,16,16,97,63,15,15,101,62,13,15,104,60,11,15,107,60,9,15,109,59,8,14,113,58,6,14,115,58,4,
		13,118,57,3,13,120,71,122,68,125,66,127,64,130,61,131,60,133,58,135,56,136,56,135,58,133,60,131,62,129,64,127,
		66,124,56,1,12,122,13,2,41,3,12,120,13,3,40,5,13,116,14,5,38,7,13,114,14,7,36,9,13,112,14,8,
		36,10,13,109,14,11,34,12,14,105,15,12,33,14,14,103,15,14,32,16,14,99,16,15,31,18,14,96,16,18,29,20,
		15,92,17,19,29,21,16,88,17,22,27,24,16,84,18,23,26,26,17,80,18,26,25,28,18,74,20,27,24,30,21,66,
		22,29,24,32,105,32,22,34,102,34,22,36,98,36,21,39,94,39,20,41,90,41,20,44,84,44,19,47,80,46,19,51,
		72,50,18,56,63,56,17,56,63,56,17,56,63,56,16,57,63,56,16,57,62,57,16,57,62,57,16,57,62,57,16,56,
		63,57,15,57,63,57,15,57,63,57,15,57,63,57,15,57,63,57,15,57,63,57,15,57,63,57,15,57,63,57,15,57,
		62,57,16,57,62,57,16,57,62,57,16,57,62,57,16,56,63,57,16,56,63,57,16,56,63,57,16,56,63,56,17,56,
		63,56,17,56,63,56,16,57,62,57,16,57,62,57,16,57,62,57,16,57,62,57,16,57,62,56,17,57,62,56,17,57,
		62,56,17,56,63,56,17,56,63,56,17,56,63,56,17,56,63,56,17,56,63,55,18,56,62,56,18,56,62,56,18,56,
		62,56,18,56,62,56,18,56,62,56,18,56,62,56,18,55,63,56,18,55,63,55,19,55,63,55,19,55,63,55,19,55,
		63,55,19,55,63,55,19,55,63,55,19,55,62,55,20,55,62,55,20,55,62,55,20,55,62,55,20,54,63,55,20,54,
		63,55,20,54,63,55,19,55,63,55,19,55,63,54,20,55,63,54,20,55,63,54,20,55,63,54,20,55,62,55,20,55,
		62,55,20,55,62,55,20,55,62,54,21,54,63,54,21,54,63,54,21,54,63,54,21,54,63,54,21,54,63,54,21,54,
		63,54,21,54,62,55,21,54,62,54,22,54,62,54,22,54,62,54,22,54,62,54,22,54,62,54,22,54,62,54,22,53,
		63,53,23,53,63,53,23,53,63,53,23,53,63,53,23,53,63,53,23,53,63,53,23,53,62,54,23,53,62,53,24,53,
		62,53,23,54,62,53,23,52,64,53,23,50,66,53,23,48,68,53,23,46,71,52,23,44,73,51,24,41,77,50,24,39,
		79,50,24,37,20,52,10,49,24,35,20,55,9,49,24,33,20,57,10,48,24,31,20,60,9,48,24,29,20,62,10,46,
		25,27,19,66,9,46,25,24,20,68,10,45,25,22,20,71,9,45,25,20,20,73,10,43,27,17,20,76,9,43,27,15,
		20,78,10,42,27,13,20,81,9,41,28,11,19,84,10,40,28,9,19,87,9,40,29,6,19,89,10,38,30,3,20,92,
		9,38,51,94,10,36,50,97,9,36,48,99,10,34,47,102,9,34,44,105,10,32,43,108,9,31,42,110,10,30,40,113,
		9,29,39,115,10,27,40,116,9,27,41,115,10,25,43,115,9,24,44,115,10,22,46,115,9,21,48,114,9,20,50,114,
		9,18,51,114,9,17,53,114,9,15,55,113,9,14,57,112,10,11,61,111,9,10,63,110,10,7,66,110,9,6,69,108,
		10,3,73,107,87,105,89,104,92,100,61,192,192,192,192,192,192,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
};

// seven
const uint8_t seven_rle[800] = {
		63,96,92,101,88,103,86,105,85,107,10,2,71,108,10,5,68,108,11,6,66,109,10,9,64,108,10,11,64,106,11,12,
		65,104,10,14,64,103,10,16,64,102,10,17,64,100,10,19,64,98,10,21,64,96,11,22,64,95,10,23,65,93,10,25,
		65,92,10,26,65,90,10,27,66,88,10,29,66,87,10,29,67,85,10,31,67,83,10,32,68,82,10,33,67,81,10,34,
		68,79,10,36,68,78,10,36,69,76,10,37,70,74,10,38,71,73,10,39,71,71,10,40,72,69,10,41,73,68,10,41,
		74,66,10,42,75,64,10,43,76,63,10,43,77,61,10,44,78,59,11,44,78,59,10,45,79,57,10,46,80,55,11,46,
		81,54,10,47,82,52,10,48,83,50,11,48,143,49,142,50,142,50,141,51,140,52,140,52,140,52,140,52,139,53,139,53,
		139,53,139,53,139,53,139,53,139,53,139,53,139,53,139,53,139,53,139,53,138,54,138,54,138,54,138,54,138,54,138,54,
		138,54,138,54,138,54,138,54,138,54,137,55,137,55,137,55,137,55,137,55,137,55,137,55,137,55,137,55,137,55,137,55,
		136,56,136,55,137,55,137,55,137,55,137,55,137,55,137,55,137,55,137,55,137,55,137,55,137,55,136,56,136,56,136,56,
		136,56,136,56,136,56,136,56,136,56,136,56,136,56,136,56,135,57,135,57,135,57,135,57,135,57,135,57,135,57,135,57,
		135,57,135,56,136,56,136,56,135,57,135,57,135,57,135,57,135,57,135,57,135,57,135,57,135,57,135,57,134,57,135,57,
		135,57,135,57,135,56,136,56,136,56,137,55,142,49,146,46,149,42,152,40,154,38,156,35,159,33,160,31,163,29,164,27,
		167,24,169,23,170,21,173,19,174,17,176,15,178,14,179,12,181,10,183,8,185,7,186,5,19,1,168,3,20,1,191,1,
		191,1,191,1,191,1,191,1,191,1,191,1,191,1,191,1,191,1,191,1,191,1,191,1,191,1,168,2,189,3,188,5,
		186,7,184,8,182,11,180,12,179,14,177,15,175,18,173,19,171,22,169,23,167,26,165,27,163,29,161,32,158,34,156,36,
		154,39,151,41,148,44,146,46,142,50,137,56,136,56,136,56,136,56,135,57,135,57,135,57,135,57,135,57,135,57,135,57,
		135,57,135,57,135,57,135,57,134,57,135,57,135,57,135,57,135,57,135,57,135,57,135,56,136,56,136,56,135,57,135,57,
		135,57,135,57,135,56,136,56,136,56,136,56,136,56,136,56,136,56,136,55,136,56,136,56,136,56,136,56,136,56,136,56,
		136,56,136,55,137,55,137,55,137,55,137,55,137,55,136,55,137,55,137,55,137,55,137,55,137,55,137,55,137,55,137,54,
		138,54,138,54,138,54,137,55,137,55,137,55,137,54,138,54,138,54,138,54,138,54,138,54,138,54,137,55,137,54,138,54,
		138,54,138,54,138,54,138,54,138,53,139,53,139,53,139,53,139,53,139,53,138,54,138,53,139,53,139,53,139,53,139,53,
		139,53,140,52,140,51,142,50,142,50,143,49,143,49,144,48,144,48,145,46,146,46,147,45,147,45,148,43,149,43,150,42,
		150,41,152,40,152,40,153,38,154,38,155,36,156,36,157,34,158,34,159,32,160,31,162,30,162,29,164,27,165,27,166,25,
		167,24,169,22,170,21,171,20,173,18,174,17,176,15,177,14,179,11,181,10,183,7,185,6,48,1,138,3,50,1,191,1,
		191,1,191,1,191,1,191,1,191,192,192,192,192,192,192,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
};

// eight
const uint8_t eight_rle[1504] = {
		63,96,92,101,88,103,86,105,85,107,10,2,71,108,10,5,68,108,11,6,66,109,10,9,64,108,10,11,64,106,11,12,
		65,104,10,14,64,103,10,16,64,102,10,17,51,2,11,100,10,19,49,4,11,98,10,21,47,5,12,96,11,22,45,7,
		12,95,10,23,44,9,12,93,10,25,42,11,12,92,10,26,40,13,12,90,10,27,40,14,12,88,10,29,38,16,12,87,
		10,29,37,18,12,85,10,31,36,19,12,83,10,32,35,21,12,82,10,33,33,23,11,81,10,34,33,24,11,79,10,36,
		31,26,11,78,10,36,31,27,11,76,10,37,30,29,11,74,10,38,30,29,12,73,10,39,28,31,12,71,10,40,28,32,
		12,69,10,41,28,33,12,68,10,41,27,35,12,66,10,42,27,36,12,64,10,43,27,37,12,63,10,43,26,39,12,61,
		10,44,26,40,12,59,11,44,26,41,11,59,10,45,26,42,11,57,10,46,25,44,11,55,11,46,25,45,11,54,10,47,
		25,46,11,52,10,48,25,47,11,50,11,48,25,48,70,49,25,48,69,50,25,49,68,50,25,50,66,51,24,52,64,52,
		24,53,63,52,24,53,63,52,24,53,63,52,24,53,62,53,24,53,62,53,23,54,62,53,23,54,62,53,23,54,62,53,
		23,53,63,53,23,53,63,53,23,53,63,53,23,53,63,53,23,53,63,53,22,54,63,53,22,54,63,53,22,54,62,54,
		22,54,62,54,22,54,62,54,22,54,62,54,22,53,63,54,21,54,63,54,21,54,63,54,21,54,63,54,21,54,63,54,
		21,54,63,54,21,54,63,54,21,54,62,55,20,55,62,55,20,55,62,55,20,55,62,55,20,55,62,55,20,55,62,55,
		20,54,63,55,20,54,63,55,19,55,63,55,19,55,63,55,19,55,63,55,19,55,62,56,19,55,62,55,20,55,62,55,
		20,55,62,55,20,55,62,55,19,56,62,55,19,56,62,55,19,55,63,55,19,55,63,55,19,55,63,55,19,55,63,55,
		19,55,63,55,18,56,63,55,18,56,62,56,18,56,62,56,18,56,62,56,18,56,62,56,18,56,62,56,18,55,63,56,
		17,56,63,56,17,56,63,56,17,56,63,56,17,56,63,56,17,56,63,56,17,56,62,57,17,56,62,57,16,57,62,57,
		16,57,62,57,16,57,62,57,16,56,63,57,16,56,63,57,16,56,63,57,16,56,63,57,15,57,63,56,16,57,63,56,
		16,57,63,56,16,57,62,57,16,57,62,57,16,57,62,57,16,57,62,57,16,57,62,57,15,57,63,57,15,57,63,57,
		15,57,63,57,15,57,63,57,15,57,63,57,15,57,62,57,16,57,62,57,16,57,62,57,16,57,62,57,16,57,62,56,
		17,57,62,56,18,56,62,56,18,54,65,55,18,48,76,49,19,45,82,46,19,43,87,42,21,39,92,40,21,37,96,38,
		21,35,100,35,22,33,104,33,23,30,107,31,24,28,21,71,19,29,24,27,19,77,17,27,26,24,18,82,17,24,27,23,
		17,86,16,23,28,20,17,90,15,21,29,19,16,94,15,19,30,16,16,97,15,17,31,15,15,101,14,15,33,13,15,104,
		13,14,33,11,15,107,13,12,35,9,15,109,13,10,36,8,14,113,12,8,38,6,14,115,12,7,39,4,13,118,12,5,
		40,3,13,120,12,3,56,122,68,125,66,127,64,130,61,131,60,133,58,135,56,136,56,135,58,133,60,131,62,129,64,127,
		66,124,56,1,12,122,13,2,41,3,12,120,13,3,40,5,13,116,14,5,38,7,13,114,14,7,36,9,13,112,14,8,
		36,10,13,109,14,11,34,12,14,105,15,12,33,14,14,103,15,14,32,16,14,99,16,15,31,18,14,96,16,18,29,20,
		15,92,17,19,29,21,16,88,17,22,27,24,16,84,18,23,26,26,17,80,18,26,25,28,18,74,20,27,24,30,21,66,
		22,29,24,32,105,32,22,34,102,34,22,36,98,36,21,39,94,39,20,41,90,41,20,44,84,44,19,47,80,46,19,51,
		72,50,18,56,63,56,17,56,63,56,17,56,63,56,16,57,63,56,16,57,62,57,16,57,62,57,16,57,62,57,16,56,
		63,57,15,57,63,57,15,57,63,57,15,57,63,57,15,57,63,57,15,57,63,57,15,57,63,57,15,57,63,57,15,57,
		62,57,16,57,62,57,16,57,62,57,16,57,62,57,16,56,63,57,16,56,63,57,16,56,63,57,16,56,63,56,17,56,
		63,56,17,56,63,56,16,57,62,57,16,57,62,57,16,57,62,57,16,57,62,57,16,57,62,56,17,57,62,56,17,57,
		62,56,17,56,63,56,17,56,63,56,17,56,63,56,17,56,63,56,17,56,63,55,18,56,62,56,18,56,62,56,18,56,
		62,56,18,56,62,56,18,56,62,56,18,56,62,56,18,55,63,56,18,55,63,55,19,55,63,55,19,55,63,55,19,55,
		63,55,19,55,63,55,19,55,63,55,19,55,62,55,20,55,62,55,20,55,62,55,20,55,62,55,20,54,63,55,20,54,
		63,55,20,54,63,55,19,55,63,55,19,55,63,54,20,55,63,54,20,55,63,54,20,55,63,54,20,55,62,55,20,55,
		62,55,20,55,62,55,20,55,62,54,21,54,63,54,21,54,63,54,21,54,63,54,21,54,63,54,21,54,63,54,21,54,
		63,54,21,54,62,55,21,54,62,54,22,54,62,54,22,54,62,54,22,54,62,54,22,54,62,54,22,54,62,54,22,53,
		63,53,23,53,63,53,23,53,63,53,23,53,63,53,23,53,63,53,23,53,63,53,23,53,62,54,23,53,62,53,24,53,
		62,53,23,54,62,53,23,52,64,53,23,50,66,53,23,48,68,53,23,46,71,52,23,44,73,51,24,41,77,50,24,39,
		79,50,24,37,20,52,10,49,24,35,20,55,9,49,24,33,20,57,10,48,24,31,20,60,9,48,24,29,20,62,10,46,
		25,27,19,66,9,46,25,24,20,68,10,45,25,22,20,71,9,45,25,20,20,73,10,43,27,17,20,76,9,43,27,15,
		20,78,10,42,27,13,20,81,9,41,28,11,19,84,10,40,28,9,19,87,9,40,29,6,19,89,10,38,30,3,20,92,
		9,38,51,94,10,36,50,97,9,36,48,99,10,34,47,102,9,34,44,105,10,32,43,108,9,31,42,110,10,30,40,113,
		9,29,39,115,10,27,40,116,9,27,41,115,10,25,43,115,9,24,44,115,10,22,46,115,9,21,48,114,9,20,50,114,
		9,18,51,114,9,17,53,114,9,15,55,113,9,14,57,112,10,11,61,111,9,10,63,110,10,7,66,110,9,6,69,108,
		10,3,73,107,87,105,89,104,92,100,61,192,192,192,192,192,192,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
};

// nine
const uint8_t nine_rle[1248] = {
		63,96,92,101,88,103,86,105,85,107,10,2,71,108,10,5,68,108,11,6,66,109,10,9,64,108,10,11,64,106,11,12,
		65,104,10,14,64,103,10,16,64,102,10,17,51,2,11,100,10,19,49,4,11,98,10,21,47,5,12,96,11,22,45,7,
		12,95,10,23,44,9,12,93,10,25,42,11,12,92,10,26,40,13,12,90,10,27,40,14,12,88,10,29,38,16,12,87,
		10,29,37,18,12,85,10,31,36,19,12,83,10,32,35,21,12,82,10,33,33,23,11,81,10,34,33,24,11,79,10,36,
		31,26,11,78,10,36,31,27,11,76,10,37,30,29,11,74,10,38,30,29,12,73,10,39,28,31,12,71,10,40,28,32,
		12,69,10,41,28,33,12,68,10,41,27,35,12,66,10,42,27,36,12,64,10,43,27,37,12,63,10,43,26,39,12,61,
		10,44,26,40,12,59,11,44,26,41,11,59,10,45,26,42,11,57,10,46,25,44,11,55,11,46,25,45,11,54,10,47,
		25,46,11,52,10,48,25,47,11,50,11,48,25,48,70,49,25,48,69,50,25,49,68,50,25,50,66,51,24,52,64,52,
		24,53,63,52,24,53,63,52,24,53,63,52,24,53,62,53,24,53,62,53,23,54,62,53,23,54,62,53,23,54,62,53,
		23,53,63,53,23,53,63,53,23,53,63,53,23,53,63,53,23,53,63,53,22,54,63,53,22,54,63,53,22,54,62,54,
		22,54,62,54,22,54,62,54,22,54,62,54,22,53,63,54,21,54,63,54,21,54,63,54,21,54,63,54,21,54,63,54,
		21,54,63,54,21,54,63,54,21,54,62,55,20,55,62,55,20,55,62,55,20,55,62,55,20,55,62,55,20,55,62,55,
		20,54,63,55,20,54,63,55,19,55,63,55,19,55,63,55,19,55,63,55,19,55,62,56,19,55,62,55,20,55,62,55,
		20,55,62,55,20,55,62,55,19,56,62,55,19,56,62,55,19,55,63,55,19,55,63,55,19,55,63,55,19,55,63,55,
		19,55,63,55,18,56,63,55,18,56,62,56,18,56,62,56,18,56,62,56,18,56,62,56,18,56,62,56,18,55,63,56,
		17,56,63,56,17,56,63,56,17,56,63,56,17,56,63,56,17,56,63,56,17,56,62,57,17,56,62,57,16,57,62,57,
		16,57,62,57,16,57,62,57,16,56,63,57,16,56,63,57,16,56,63,57,16,56,63,57,15,57,63,56,16,57,63,56,
		16,57,63,56,16,57,62,57,16,57,62,57,16,57,62,57,16,57,62,57,16,57,62,57,15,57,63,57,15,57,63,57,
		15,57,63,57,15,57,63,57,15,57,63,57,15,57,62,57,16,57,62,57,16,57,62,57,16,57,62,57,16,57,62,56,
		17,57,62,56,18,56,62,56,18,54,65,55,18,48,76,49,19,45,82,46,19,43,87,42,21,39,92,40,21,37,96,38,
		21,35,100,35,22,33,104,33,23,30,107,31,24,28,21,71,19,29,24,27,19,77,17,27,26,24,18,82,17,24,27,23,
		17,86,16,23,28,20,17,90,15,21,29,19,16,94,15,19,30,16,16,97,15,17,31,15,15,101,14,15,33,13,15,104,
		13,14,33,11,15,107,13,12,35,9,15,109,13,10,36,8,14,113,12,8,38,6,14,115,12,7,39,4,13,118,12,5,
		40,3,13,120,12,3,56,122,68,125,66,127,64,130,61,131,60,133,58,135,56,136,56,135,58,133,60,131,62,129,64,127,
		66,124,69,122,13,2,56,120,13,3,58,116,14,5,58,114,14,7,58,112,14,8,59,109,14,11,60,105,15,12,61,103,
		15,14,62,99,16,15,63,96,16,18,64,92,17,19,66,88,17,22,67,84,18,23,69,80,18,26,71,74,20,27,75,66,
		22,29,161,32,158,34,156,36,154,39,151,41,148,44,146,46,142,50,137,56,136,56,136,56,136,56,135,57,135,57,135,57,
		135,57,135,57,135,57,135,57,135,57,135,57,135,57,135,57,134,57,135,57,135,57,135,57,135,57,135,57,135,57,135,56,
		136,56,136,56,135,57,135,57,135,57,135,57,135,56,136,56,136,56,136,56,136,56,136,56,136,56,136,55,136,56,136,56,
		136,56,136,56,136,56,136,56,136,56,136,55,137,55,137,55,137,55,137,55,137,55,136,55,137,55,137,55,137,55,137,55,
		137,55,137,55,137,55,137,54,138,54,138,54,138,54,137,55,137,55,137,55,137,54,138,54,138,54,138,54,138,54,138,54,
		138,54,137,55,137,54,138,54,138,54,138,54,138,54,138,54,138,53,139,53,139,53,139,53,139,53,139,53,138,54,138,53,
		139,53,139,53,139,53,139,53,139,53,140,52,140,51,142,50,142,50,81,52,10,49,79,55,9,49,77,57,10,48,75,60,
		9,48,73,62,10,46,71,66,9,46,69,68,10,45,67,71,9,45,65,73,10,43,64,76,9,43,62,78,10,42,60,81,
		9,41,58,84,10,40,56,87,9,40,54,89,10,38,53,92,9,38,51,94,10,36,50,97,9,36,48,99,10,34,47,102,
		9,34,44,105,10,32,43,108,9,31,42,110,10,30,40,113,9,29,39,115,10,27,40,116,9,27,41,115,10,25,43,115,
		9,24,44,115,10,22,46,115,9,21,48,114,9,20,50,114,9,18,51,114,9,17,53,114,9,15,55,113,9,14,57,112,
		10,11,61,111,9,10,63,110,10,7,66,110,9,6,69,108,10,3,73,107,87,105,89,104,92,100,61,192,192,192,192,192,
		192,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
};

// zero
const uint8_t zero_rle[1440] = {
		63,96,92,101,88,103,86,105,85,107,10,2,71,108,10,5,68,108,11,6,66,109,10,9,64,108,10,11,64,106,11,12,
		65,104,10,14,64,103,10,16,64,102,10,17,51,2,11,100,10,19,49,4,11,98,10,21,47,5,12,96,11,22,45,7,
		12,95,10,23,44,9,12,93,10,25,42,11,12,92,10,26,40,13,12,90,10,27,40,14,12,88,10,29,38,16,12,87,
		10,29,37,18,12,85,10,31,36,19,12,83,10,32,35,21,12,82,10,33,33,23,11,81,10,34,33,24,11,79,10,36,
		31,26,11,78,10,36,31,27,11,76,10,37,30,29,11,74,10,38,30,29,12,73,10,39,28,31,12,71,10,40,28,32,
		12,69,10,41,28,33,12,68,10,41,27,35,12,66,10,42,27,36,12,64,10,43,27,37,12,63,10,43,26,39,12,61,
		10,44,26,40,12,59,11,44,26,41,11,59,10,45,26,42,11,57,10,46,25,44,11,55,11,46,25,45,11,54,10,47,
		25,46,11,52,10,48,25,47,11,50,11,48,25,48,70,49,25,48,69,50,25,49,68,50,25,50,66,51,24,52,64,52,
		24,53,63,52,24,53,63,52,24,53,63,52,24,53,62,53,24,53,62,53,23,54,62,53,23,54,62,53,23,54,62,53,
		23,53,63,53,23,53,63,53,23,53,63,53,23,53,63,53,23,53,63,53,22,54,63,53,22,54,63,53,22,54,62,54,
		22,54,62,54,22,54,62,54,22,54,62,54,22,53,63,54,21,54,63,54,21,54,63,54,21,54,63,54,21,54,63,54,
		21,54,63,54,21,54,63,54,21,54,62,55,20,55,62,55,20,55,62,55,20,55,62,55,20,55,62,55,20,55,62,55,
		20,54,63,55,20,54,63,55,19,55,63,55,19,55,63,55,19,55,63,55,19,55,62,56,19,55,62,55,20,55,62,55,
		20,55,62,55,20,55,62,55,19,56,62,55,19,56,62,55,19,55,63,55,19,55,63,55,19,55,63,55,19,55,63,55,
		19,55,63,55,18,56,63,55,18,56,62,56,18,56,62,56,18,56,62,56,18,56,62,56,18,56,62,56,18,55,63,56,
		17,56,63,56,17,56,63,56,17,56,63,56,17,56,63,56,17,56,63,56,17,56,62,57,17,56,62,57,16,57,62,57,
		16,57,62,57,16,57,62,57,16,56,63,57,16,56,63,57,16,56,63,57,16,56,63,57,15,57,63,56,16,57,63,56,
		16,57,63,56,16,57,62,57,16,57,62,57,16,57,62,57,16,57,62,57,16,57,62,57,15,57,63,57,15,57,63,57,
		15,57,63,57,15,57,63,57,15,57,63,57,15,57,62,57,16,57,62,57,16,57,62,57,16,57,62,57,16,57,62,56,
		17,57,62,56,18,56,62,56,18,54,65,55,18,48,76,49,19,45,82,46,19,43,87,42,21,39,92,40,21,37,96,38,
		21,35,100,35,22,33,104,33,23,30,107,31,24,28,111,29,24,27,113,27,26,24,117,24,27,23,119,23,28,20,122,21,
		29,19,125,19,30,16,128,17,31,15,130,15,33,13,132,14,33,11,135,12,35,9,137,10,36,8,139,8,38,6,141,7,
		39,4,143,5,40,3,145,3,20,1,191,1,191,1,191,1,191,1,191,1,191,1,191,1,191,1,191,1,191,1,191,1,
		191,1,191,1,212,1,147,2,41,3,145,3,40,5,143,5,38,7,141,7,36,9,139,8,36,10,136,11,34,12,134,12,
		33,14,132,14,32,16,129,15,31,18,126,18,29,20,124,19,29,21,121,22,27,24,118,23,26,26,115,26,25,28,112,27,
		24,30,109,29,24,32,105,32,22,34,102,34,22,36,98,36,21,39,94,39,20,41,90,41,20,44,84,44,19,47,80,46,
		19,51,72,50,18,56,63,56,17,56,63,56,17,56,63,56,16,57,63,56,16,57,62,57,16,57,62,57,16,57,62,57,
		16,56,63,57,15,57,63,57,15,57,63,57,15,57,63,57,15,57,63,57,15,57,63,57,15,57,63,57,15,57,63,57,
		15,57,62,57,16,57,62,57,16,57,62,57,16,57,62,57,16,56,63,57,16,56,63,57,16,56,63,57,16,56,63,56,
		17,56,63,56,17,56,63,56,16,57,62,57,16,57,62,57,16,57,62,57,16,57,62,57,16,57,62,56,17,57,62,56,
		17,57,62,56,17,56,63,56,17,56,63,56,17,56,63,56,17,56,63,56,17,56,63,55,18,56,62,56,18,56,62,56,
		18,56,62,56,18,56,62,56,18,56,62,56,18,56,62,56,18,55,63,56,18,55,63,55,19,55,63,55,19,55,63,55,
		19,55,63,55,19,55,63,55,19,55,63,55,19,55,62,55,20,55,62,55,20,55,62,55,20,55,62,55,20,54,63,55,
		20,54,63,55,20,54,63,55,19,55,63,55,19,55,63,54,20,55,63,54,20,55,63,54,20,55,63,54,20,55,62,55,
		20,55,62,55,20,55,62,55,20,55,62,54,21,54,63,54,21,54,63,54,21,54,63,54,21,54,63,54,21,54,63,54,
		21,54,63,54,21,54,62,55,21,54,62,54,22,54,62,54,22,54,62,54,22,54,62,54,22,54,62,54,22,54,62,54,
		22,53,63,53,23,53,63,53,23,53,63,53,23,53,63,53,23,53,63,53,23,53,63,53,23,53,62,54,23,53,62,53,
		24,53,62,53,23,54,62,53,23,52,64,53,23,50,66,53,23,48,68,53,23,46,71,52,23,44,73,51,24,41,77,50,
		24,39,79,50,24,37,20,52,10,49,24,35,20,55,9,49,24,33,20,57,10,48,24,31,20,60,9,48,24,29,20,62,
		10,46,25,27,19,66,9,46,25,24,20,68,10,45,25,22,20,71,9,45,25,20,20,73,10,43,27,17,20,76,9,43,
		27,15,20,78,10,42,27,13,20,81,9,41,28,11,19,84,10,40,28,9,19,87,9,40,29,6,19,89,10,38,30,3,
		20,92,9,38,51,94,10,36,50,97,9,36,48,99,10,34,47,102,9,34,44,105,10,32,43,108,9,31,42,110,10,30,
		40,113,9,29,39,115,10,27,40,116,9,27,41,115,10,25,43,115,9,24,44,115,10,22,46,115,9,21,48,114,9,20,
		50,114,9,18,51,114,9,17,53,114,9,15,55,113,9,14,57,112,10,11,61,111,9,10,63,110,10,7,66,110,9,6,
		69,108,10,3,73,107,87,105,89,104,92,100,61,192,192,192,192,192,192,0,0,0,0,0,0,0,0,0,0,0,0,0
};

const uint32_t point[44] = {
		0xFC00003F,0xF800000F,0xF000000F,0xE000000F,
		0xE000000F,0xC000000F,0xC000000F,0xC000000F,0xC000000F,0xC000000F,0xC000000F,0xC000000F,
		0xC000000F,0xC000000F,0xC000000F,0xC000000F,0xC000001F,0xC000001F,0xC000001F,0xC000001F,
		0x8000001F,0x8000001F,0x8000001F,0x8000001F,0x8000001F,0x8000001F,0x8000001F,0x8000001F,
		0x8000001F,0x8000001F,0x0000001F,0x0000001F,0x0000001F,0x0000001F,0x0000003F,0x0000003F,
		0x0000003F,0x0000003F,0x0000003F,0x0000007F,0x0000007F,0x000000FF,0x800001FF,0xE00003FF
};

volatile uint32_t SRC_Buffer[800];

uint32_t frame_Buffer[12000];


/* Private function prototypes -----------------------------------------------*/
void RCC_Configuration(void);
void GPIO_Configuration(void);
void USART_Configuration(void);
void DMA_Configuration(void);
void NVIC_Configuration(void);
void TIM_Configuration(void);

/*
 * This routine fills the ff[] array with a monochrome bitmap
 * representing a single digit, by expanding the compressed
 * bitmap found in the pp[] array. There are 10 compressed
 * bitmaps permanently stored in flash memory: zero_rle, one_rle,
 * two_rle, three_rle, four_rle, five_rle, six_rle, seven_rle,
 * eight_rle, and nine_rle. The resulting bitmap ff[] is
 * monochrome (one bit/pixel), has 344 rows and 192 columns,
 * with an array size of (344*192)/32 = 2064 words.
 * It is created on the fly when a digit needs to be displayed,
 * before being copied to the frame buffer.
 */
void Extract(uint32_t digit, const uint8_t pp[], uint32_t ff[])
{
	uint32_t a, b, c, d, slices, fmode, r, teemp, correction, i, j;

	i = 0;
	j = 0;
	fmode = 1;
	correction = 0;

	a = pp[0];

	  while(j < 2064)
	  {
		  b = a + pp[i+1];
		  c = b + pp[i+2];
		  d = c + pp[i+3];

		  if (a >= 32)
			  slices = 1;
		  else if (b >= 32)
			  slices = 2;
		  else if(c >= 32)
			  slices = 3;
		  else
			  slices = 4;

		  switch (slices)
		  {
		  	  case 1:
		  		ff[j] = 0xFFFFFFFF;
		  		if (fmode == 0)
		  			ff[j] = ~(ff[j]);
		  		if(a == 32)
		  		{
		  			i++;
		  			a = pp[i];
		  			if(fmode == 0)
		  				fmode = 1;
		  			else fmode = 0;
			  	}
		  		else
		  		{
		  			a = a - 32;
		  		}
		  		break;
		  	  case 2:
		  		  r = b - 32;
		  		ff[j] = 0xFFFFFFFF << (32 - a);
		  		  if (fmode == 0)
		  			ff[j] = ~(ff[j]);
		  		  if(r == 0)
		  		  {
		  			  i = i + 2;
		  			  a = pp[i];
		  		  }
		  		  else
		  		  {
		  			  i++;
		  			  correction = 32 - a;
		  			  a = pp[i] - correction;
		  			  if(fmode == 0)
		  				  fmode = 1;
		  			  else fmode = 0;
		  		  }
		  		  break;
		  	  case 3:
		  		  r = c - 32;
		  		  ff[j] = 0xFFFFFFFF << (32 - a);
		  		  teemp = (1 << (32 - b)) - 1;
		  		  ff[j] += teemp;
		  		  if (fmode == 0)
		  			  ff[j] = ~(ff[j]);
		  		  if(r == 0)
		  		  {
		  			  i = i + 3;
		  			  a = pp[i];
		  		  	  if(fmode == 0)
		  		  		  fmode = 1;
		  			  else fmode = 0;
		  		  }
		  		  else
		  		  {
		  			   i = i + 2;
		  		  	   correction = 32 - b;
		  		  	   a = pp[i] - correction;
		  		  }
		  		  break;
		  	  case 4:
		  		  r = d - 32;
		  		  ff[j] = (1 << (b - a)) - 1;
		  		  ff[j] = ff[j] << (32 - b);
		  		  teemp = (1 << (32 - c)) - 1;
		  		  ff[j] += teemp;
		  		  if (fmode == 1)
		  			  ff[j] = ~(ff[j]);
		  		  if(r == 0)
		  		  {
		  			  i = i + 4;
		  			  a = pp[i];
		  		  }
		  		  else
		  		  {
		  			  i = i + 3;
		  			  correction = 32 - c;
		  			  a = pp[i] - correction;
		  			  if(fmode == 0)
		  				  fmode = 1;
		  			  else fmode = 0;
		  		  }
		  		  break;
		  }
		  j++;
	  }
	  if(digit == 1)
	  {
		 for(i = 163; i < 179; i++)
			 ff[i*6] = 0xffffffff;
		 for(i = 0; i < 6; i++)
		 	ff[i*6] = 0xffffffff;
		 for(i = 336; i < 344; i++)
		 	ff[i*6] = 0xffffffff;
	  }
	  if(digit == 4)
	  	  {
	  		 for(i = 0; i < 6; i++)
	  		 	ff[i*6] = 0xffffffff;
	  		 for(i = 336; i < 344; i++)
	  		 	ff[i*6] = 0xffffffff;
	  	  }
	  if(digit == 7)
	  	  {
	  		 for(i = 163; i < 179; i++)
	  			 ff[i*6] = 0xffffffff;
	  		 for(i = 336; i < 344; i++)
	  		 	ff[i*6] = 0xffffffff;
	  	  }
	  if(digit == 10)
	  {
		  for(i = 163; i < 178; i++)
			  ff[i*6] = 0xffffffff;
	  }
}




/* Private functions ---------------------------------------------------------*/

/**
  * @brief  Main program
  * @param  None
  * @retval None
  */
int main(void)
{
	/*!< At this stage the microcontroller clock setting is already configured,
       this is done through SystemInit() function which is called from startup
       file (startup_stm32f4xx.s) before to branch to application main.
        To reconfigure the default setting of SystemInit() function, refer to
       system_stm32f4xx.c file
	*/

	uint32_t i, j, k, ibad;

	/* System Clocks Configuration */
	RCC_Configuration();

	/* Configure the GPIO ports */
	GPIO_Configuration();

	USART_Configuration();
	DMA_Configuration();
	NVIC_Configuration();
	TIM_Configuration();

	idx = 0;

	GPIO_SetBits(GPIOC, GPIO_Pin_0 | GPIO_Pin_1 | GPIO_Pin_2 | GPIO_Pin_3 | GPIO_Pin_4 | GPIO_Pin_5);

	/* TIM2,3,4 enable counter */
	TIM_Cmd(TIM4, ENABLE);
	TIM_Cmd(TIM2, ENABLE);
	TIM_Cmd(TIM3, ENABLE);

	/* Enable USART3's DMA interface */
	USART_DMACmd(USART3, USART_DMAReq_Rx, ENABLE);

	/* Enable DMA1's Stream1 */
	DMA_Cmd(DMA1_Stream1, ENABLE);

	/* Wait until DMA1's Stream1 is effectively enabled */
	while(DMA_GetCmdStatus(DMA1_Stream1) != ENABLE);

	for(i = 0; i < 12000; i++)
	{
		frame_Buffer[i] = 0xFFFFFFFF;
	}

	i = 0;
	j = 0;
	fmode = 1;
	correction = 0;

	//chiffre = 0;
	number0 = 0;
	number1 = 0;
	number2 = 0;

	while (1)
	{
		if(toggle == 1)
		{
			// We've got an interrupt signaling it's time to send the contents
			// of the line buffer to the FEMA display through GPIO port C
			if(line_number < 480)
			{
				// Get the address of GPIO port C, of TIM3 counter value, and of the line buffer array.
				asm volatile("LDR r5, = 0x40020814\n\t":::"r5","r6","r8","r9","r10","r11");   // GPIOC->ODR
				asm volatile("LDR r10, = 0x40000424\n\t");  // TIM3->CNT
				asm volatile("LDR r6, = SRC_Buffer\n\t");
				asm volatile("MOV r8, r6\n\t");
				asm volatile("SUB r9, r9, r9\n\t");

				// Copy the first word from the line buffer to GPIO port C,
				// and post-increment the line buffer pointer
				asm volatile("LDR r6, [r8], #4\n\t""STR r6, [r5]\n\t"::);

				// Wait for the pixel clock's falling edge, i.e. until TIM3->CNT >= 15
				asm volatile("grab:LDR r11, [r10]\n\t");
				asm volatile("CMP r11, #15\n\t");
				asm volatile("BLT grab\n\t");

				// Copy the next word from the line buffer to GPIO port C,
				// and post-increment the line buffer pointer
				asm volatile("LDR r6, [r8], #4\n\t""STR r6, [r5]\n\t"::);

				// Wait for the pixel clock's rising edge, i.e. until TIM3->CNT < 16
				asm volatile("grab2:LDR r11, [r10]\n\t");
				asm volatile("CMP r11, #16\n\t");
				asm volatile("BGT grab2\n\t");

				// Loop until 800 words (one line) are transfered
				asm volatile("ADD r9, r9, #1\n\t");
				asm volatile("CMP r9, #800\n\t");
				asm volatile("BNE grab\n\t");

				// Update the line buffer in preparation for next transfer
				// Get the next line number
				asm volatile("LDR r5, = line_number\n\t");
				asm volatile("LDR r5, [r5]\n\t");

				// Calculate the offset to the frame buffer pointer
				asm volatile("MOV r10, #100\n\t");
				asm volatile("MUL r10, r5, r10\n\t");

				// Adjust the frame buffer pointer
				asm volatile("LDR r5, = frame_Buffer\n\t");
				asm volatile("ADD r5, r5, r10\n\t");

				// Get the line buffer address
				asm volatile("LDR r6, = SRC_Buffer\n\t");
				asm volatile("MOV r11, r6\n\t");

				// Get the first 32 bits word (32 pixels) from the frame buffer,
				// and post-increment the frame buffer pointer
				asm volatile("SUB r9, r9, r9\n\t");
				asm volatile("next_chunk:LDR r10, [r5], #4\n\t");

				// Loop through the 32 bits, and each time write a word
				// to the line buffer, with a value of either 0x00000000
				// or 0xffffffff depending on the bit value
				asm volatile("SUB r8, r8, r8\n\t");
				asm volatile("next_bit:SUB r6, r6, r6\n\t");
				asm volatile("MOVS r10, r10, LSL #1\n\t");
				asm volatile("BCS black\n\t");
				asm volatile("SUB r6, r6, #1\n\t");
				asm volatile("black:STR r6, [r11], #4\n\t");
				asm volatile("ADD r8, r8, #1\n\t");
				asm volatile("CMP r8, #32\n\t");
				asm volatile("BNE next_bit\n\t");

				// Loop until 25 words of the frame buffer (i.e. one line) are processed
				asm volatile("ADD r9, r9, #1\n\t");
				asm volatile("CMP r9, #25\n\t");
				asm volatile("BNE next_chunk\n\t");
			}
			toggle = 0;
		}

		if(letsgo == 1)
		// We've got an interrupt signaling the beginning of the delay between 2 frames.
		// Refresh the frame buffer with the most recent GPS SOG value.
		{
			GPIO_ToggleBits(GPIOD, GPIO_Pin_12);

			flag = DMA_GetFlagStatus(DMA1_Stream1, DMA_FLAG_TCIF1);
			if(flag != RESET)    // we have a full buffer
			{
				DMA_ClearFlag(DMA1_Stream1, DMA_FLAG_TCIF1);
				m_index = !DMA_GetCurrentMemoryTarget(DMA1_Stream1);
				// process buffer buf_nmea
				for(i = 0; i < 80; i++)
				{
					if(m_index == 0)
						temprec = USART_Buffer_Rx0[i];
					else
						temprec = USART_Buffer_Rx1[i];
					if(temprec != '\n')
					{
						buf_nmea[idx++] = temprec;
					}
					else
					{
						idx = 0;
						// $GPRMC,180846.600,A,4659.9999,N,07059.9999,W,6.00,45.00,050210,,,D*77
						// $GPRMC,081836,A,3751.65,S,14507.36,E,000.0,360.0,130998,011.3,E*62
						// $GPRMC,220516,A,5133.82,N,00042.24,W,173.8,231.8,130694,004.2,W*70
						// $GPRMC,hhmmss.ss,A,llll.ll,a,yyyyy.yy,a,x.x,x.x,ddmmyy,x.x,a*hh

						if(buf_nmea[0] == '$' && buf_nmea[1] == 'G' && buf_nmea[3] == 'R' && buf_nmea[5] == 'C')
						{
							ibad = 1;
							// find the position of the 'W' or 'E' character
							for(j = 35; j < 45; j++)
							{
								if(buf_nmea[j] == 'W' || buf_nmea[j] == 'E')
								{
									ibad = 0;
									break;
								}
							}
							if(ibad == 0)
							{
								ibad = 1;
								// find the position of the SOG decimal point
								for(k = j; k < (j + 7); k++)
								{
									if(buf_nmea[k] == '.')
									{
										ibad = 0;
										break;
									}
								}
							}
							if(ibad == 0)
							{
								if(k < 52)
								{
									number0 = (uint32_t)(buf_nmea[k+1]) - 48;  // number of 0.1 knot
									number1 = (uint32_t)(buf_nmea[k-1]) - 48;  // number of 1.0 knot
									number2 = (uint32_t)(buf_nmea[k-2]) - 48;  // number of 10.0 knots
								}
							}
						}
					}
				}
			}

			if(number0 == 0)
				number0 = 10;
			if(number1 == 0)
				number1 = 10;
			if(number2 <= 0 || number2 > 9)
				number2 = 999;  // erase existing digit

			switch(number0)
			{
		  	  case 1:
		  		  Extract(1, one_rle, fbuf);
		  		  break;
		  	  case 2:
		  		  Extract(2, two_rle, fbuf);
		  		  break;
		  	  case 3:
		  		  Extract(3, three_rle, fbuf);
		  		  break;
		  	  case 4:
		  		  Extract(4, four_rle, fbuf);
		  		  break;
		  	  case 5:
		  		  Extract(5, five_rle, fbuf);
		  		  break;
		  	  case 6:
		  		  Extract(6, six_rle, fbuf);
		  		  break;
		  	  case 7:
		  		  Extract(7, seven_rle, fbuf);
		  		  break;
		  	  case 8:
		  		  Extract(8, eight_rle, fbuf);
		  		  break;
		  	  case 9:
		  		  Extract(9, nine_rle, fbuf);
		  		  break;
		  	  case 10:
		  		  Extract(10, zero_rle, fbuf);
		  		  break;
			}
			bmadd = 0;
			for(i = 0; i < 342; i++)
			{
				fbad = 25 * 30 + 25 * i + 17;
				for(j = 0; j < 6; j++)
				{
					frame_Buffer[fbad] = fbuf[bmadd];
					fbad++;
					bmadd++;
				}
			}

			switch(number1)
			{
		  	  case 1:
		  		  Extract(1, one_rle, fbuf);
		  		  break;
		  	  case 2:
		  		  Extract(2, two_rle, fbuf);
		  		  break;
		  	  case 3:
		  		  Extract(3, three_rle, fbuf);
		  		  break;
		  	  case 4:
		  		  Extract(4, four_rle, fbuf);
		  		  break;
		  	  case 5:
		  		  Extract(5, five_rle, fbuf);
		  		  break;
		  	  case 6:
		  		  Extract(6, six_rle, fbuf);
		  		  break;
		  	  case 7:
		  		  Extract(7, seven_rle, fbuf);
		  		  break;
		  	  case 8:
		  		  Extract(8, eight_rle, fbuf);
		  		  break;
		  	  case 9:
		  		  Extract(9, nine_rle, fbuf);
		  		  break;
		  	  case 10:
		  		  Extract(10, zero_rle, fbuf);
		  		  break;
			}

			bmadd = 0;
			for(i = 0; i < 342; i++)
			{
				fbad = 25 * 30 + 25 * i + 9;
				for(j = 0; j < 6; j++)
				{
					frame_Buffer[fbad] = fbuf[bmadd];
					fbad++;
					bmadd++;
				}
			}

		  switch(number2)
		  {
		  	  case 1:
		  		  Extract(1, one_rle, fbuf);
		  		  break;
			  case 2:
				  Extract(2, two_rle, fbuf);
				  break;
			  case 3:
				  Extract(3, three_rle, fbuf);
				  break;
			  case 4:
				  Extract(4, four_rle, fbuf);
				  break;
			  case 5:
				  Extract(5, five_rle, fbuf);
				  break;
			  case 6:
				  Extract(6, six_rle, fbuf);
				  break;
			  case 7:
				  Extract(7, seven_rle, fbuf);
				  break;
			  case 8:
				  Extract(8, eight_rle, fbuf);
				  break;
			  case 9:
				  Extract(9, nine_rle, fbuf);
				  break;
			  case 999:
				  for(i = 0; i < 2064; i++)
					  fbuf[i] = 0xffffffff;
		  }

		  bmadd = 0;
		  for(i = 0; i < 342; i++)
		  {
			  fbad = 25 * 30 + 25 * i + 2;
			  for(j = 0; j < 6; j++)
			  {
				  frame_Buffer[fbad] = fbuf[bmadd];
				  fbad++;
				  bmadd++;
			  }
		  }

			// draw decimal point
			for(i = 0; i < 44; i++)
			{
				frame_Buffer[(328 + i) * 25 + 15] = point[i];
			}
			letsgo = 0;
		}
	}
}

void RCC_Configuration(void)
{
	/* TIM2,3,4 clock enable */
	RCC_APB1PeriphClockCmd(RCC_APB1Periph_TIM2 | RCC_APB1Periph_TIM3 | RCC_APB1Periph_TIM4, ENABLE);
	/* USART3 clock enable */
	RCC_APB1PeriphClockCmd(RCC_APB1Periph_USART3, ENABLE);

	/* GPIOB,C,D clock enable */
	RCC_AHB1PeriphClockCmd(RCC_AHB1Periph_GPIOB, ENABLE);
	RCC_AHB1PeriphClockCmd(RCC_AHB1Periph_GPIOC, ENABLE);  // pour red PC0  5
	RCC_AHB1PeriphClockCmd(RCC_AHB1Periph_GPIOD, ENABLE);

	// Enable The DMA controller clock
	RCC_AHB1PeriphClockCmd(RCC_AHB1Periph_DMA1, ENABLE);
}

void GPIO_Configuration(void)
{
	GPIO_InitTypeDef GPIO_InitStructure;

	/* Configure PD12, PD13, PD14 and PD15 in output pushpull mode */
	GPIO_InitStructure.GPIO_Pin = GPIO_Pin_12 | GPIO_Pin_13| GPIO_Pin_14| GPIO_Pin_15;
	GPIO_InitStructure.GPIO_Mode = GPIO_Mode_OUT;
	GPIO_InitStructure.GPIO_Speed = GPIO_Speed_100MHz;
	GPIO_InitStructure.GPIO_OType = GPIO_OType_PP;
	GPIO_InitStructure.GPIO_PuPd = GPIO_PuPd_NOPULL;
	GPIO_Init(GPIOD, &GPIO_InitStructure);

	// Configure PD9 as USART3_RX
	GPIO_InitStructure.GPIO_Pin = GPIO_Pin_9;
	GPIO_InitStructure.GPIO_Mode = GPIO_Mode_AF;
	GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;
	GPIO_InitStructure.GPIO_OType = GPIO_OType_PP;
	GPIO_InitStructure.GPIO_PuPd = GPIO_PuPd_UP;
	GPIO_Init(GPIOD, &GPIO_InitStructure);

	GPIO_PinAFConfig(GPIOD, GPIO_PinSource9, GPIO_AF_USART3);

	/* Configure PC0 to PC5 in output pushpull mode */
	GPIO_InitStructure.GPIO_Pin = GPIO_Pin_0 | GPIO_Pin_1 | GPIO_Pin_2 | GPIO_Pin_3 | GPIO_Pin_4 | GPIO_Pin_5;
	GPIO_InitStructure.GPIO_Mode = GPIO_Mode_OUT;
	GPIO_InitStructure.GPIO_OType = GPIO_OType_PP;
	GPIO_InitStructure.GPIO_Speed = GPIO_Speed_100MHz;
	GPIO_InitStructure.GPIO_PuPd = GPIO_PuPd_NOPULL;
	GPIO_Init(GPIOC, &GPIO_InitStructure);

	/* GPIOB Configuration:  TIM3 CH3 (PB0) */
	GPIO_InitStructure.GPIO_Pin = GPIO_Pin_0;
	GPIO_InitStructure.GPIO_Mode = GPIO_Mode_AF;
	GPIO_InitStructure.GPIO_PuPd = GPIO_PuPd_UP;
	GPIO_Init(GPIOB, &GPIO_InitStructure);
	/* Connect TIM3 pins to AF2 */
	GPIO_PinAFConfig(GPIOB, GPIO_PinSource0, GPIO_AF_TIM3);

	/* GPIOB Configuration:  TIM4 CH1 (PB6) */
	GPIO_InitStructure.GPIO_Pin = GPIO_Pin_6;
	GPIO_Init(GPIOB, &GPIO_InitStructure);
	/* Connect TIM4 pins to AF2 */
	GPIO_PinAFConfig(GPIOB, GPIO_PinSource6, GPIO_AF_TIM4);
}

void USART_Configuration(void)
{
	USART_InitTypeDef USART_InitStruct;

	USART_InitStruct.USART_BaudRate = 4800;
	USART_InitStruct.USART_WordLength = USART_WordLength_8b;
	USART_InitStruct.USART_StopBits = USART_StopBits_1;
	USART_InitStruct.USART_Parity = USART_Parity_No;
	USART_InitStruct.USART_HardwareFlowControl = USART_HardwareFlowControl_None;
	USART_InitStruct.USART_Mode = USART_Mode_Rx;
	USART_Init(USART3, &USART_InitStruct);

	USART_Cmd(USART3, ENABLE);
}

void DMA_Configuration(void)
{
	DMA_InitTypeDef  DMA_InitStructure;

	// USART3_RX DMA Channel 4, DMA1, Stream1
	DMA_DeInit(DMA1_Stream1);
	DMA_InitStructure.DMA_PeripheralBaseAddr = (uint32_t)&USART3->DR;
	DMA_InitStructure.DMA_PeripheralInc      = DMA_PeripheralInc_Disable;
	DMA_InitStructure.DMA_MemoryInc          = DMA_MemoryInc_Enable;
 	DMA_InitStructure.DMA_PeripheralDataSize = DMA_PeripheralDataSize_Byte;
	DMA_InitStructure.DMA_MemoryDataSize     = DMA_MemoryDataSize_Byte;
	DMA_InitStructure.DMA_Mode               = DMA_Mode_Circular;
	DMA_InitStructure.DMA_FIFOMode           = DMA_FIFOMode_Enable;
	DMA_InitStructure.DMA_FIFOThreshold      = DMA_FIFOThreshold_HalfFull;
	DMA_InitStructure.DMA_MemoryBurst        = DMA_MemoryBurst_Single;
	DMA_InitStructure.DMA_PeripheralBurst    = DMA_PeripheralBurst_Single;
	DMA_InitStructure.DMA_Priority           = DMA_Priority_VeryHigh;
	DMA_InitStructure.DMA_Channel            = DMA_Channel_4;
	DMA_InitStructure.DMA_DIR                = DMA_DIR_PeripheralToMemory;
	DMA_InitStructure.DMA_Memory0BaseAddr    = (uint32_t)USART_Buffer_Rx0;
	DMA_InitStructure.DMA_BufferSize         = 80;
	DMA_Init(DMA1_Stream1, &DMA_InitStructure);

	DMA_DoubleBufferModeConfig(DMA1_Stream1, (uint32_t)USART_Buffer_Rx1, DMA_Memory_0);
	DMA_DoubleBufferModeCmd(DMA1_Stream1, ENABLE);
}

void NVIC_Configuration(void)
{
	NVIC_InitTypeDef NVIC_InitStructure;

	/* Enable the TIM2 global Interrupt */
	NVIC_InitStructure.NVIC_IRQChannel = TIM2_IRQn;
	NVIC_InitStructure.NVIC_IRQChannelPreemptionPriority = 0;
	NVIC_InitStructure.NVIC_IRQChannelSubPriority = 1;
	NVIC_InitStructure.NVIC_IRQChannelCmd = ENABLE;
	NVIC_Init(&NVIC_InitStructure);
}

void TIM_Configuration(void)
{
	TIM_TimeBaseInitTypeDef TIM_TimeBaseStructure;
	TIM_OCInitTypeDef TIM_OCInitStructure;

	/* TIM3 Time base configuration */
	TIM_TimeBaseStructure.TIM_Prescaler = 0;
	TIM_TimeBaseStructure.TIM_Period = 31;
	TIM_TimeBaseStructure.TIM_ClockDivision = 0;
	TIM_TimeBaseStructure.TIM_CounterMode = TIM_CounterMode_Up;

	TIM_TimeBaseInit(TIM3, &TIM_TimeBaseStructure);

	/* TIM3 PWM1 Mode configuration: Channel3 */
	TIM_OCInitStructure.TIM_OCMode = TIM_OCMode_PWM1;
	TIM_OCInitStructure.TIM_OCPolarity = TIM_OCPolarity_High;
	TIM_OCInitStructure.TIM_OutputState = TIM_OutputState_Enable;
	TIM_OCInitStructure.TIM_Pulse = 16;

	TIM_OC3Init(TIM3, &TIM_OCInitStructure);
	TIM_OC3PreloadConfig(TIM3, TIM_OCPreload_Enable);

	/* TIM3 update will be used as a trigger source */
	TIM_SelectOutputTrigger(TIM3, TIM_TRGOSource_Update);
	TIM_SelectMasterSlaveMode(TIM3, TIM_MasterSlaveMode_Enable);

	/* TIM4 Time base configuration */
	TIM_TimeBaseStructure.TIM_Period = 1055;
	TIM_TimeBaseStructure.TIM_Prescaler = 0;
	TIM_TimeBaseStructure.TIM_ClockDivision = 0;
	TIM_TimeBaseStructure.TIM_CounterMode = TIM_CounterMode_Up;

	TIM_TimeBaseInit(TIM4, &TIM_TimeBaseStructure);

	/* TIM4 PWM1 Mode configuration: Channel1 */
	TIM_OCInitStructure.TIM_OCMode = TIM_OCMode_PWM1;
	TIM_OCInitStructure.TIM_OutputState = TIM_OutputState_Enable;
	TIM_OCInitStructure.TIM_OCPolarity = TIM_OCPolarity_High;
	TIM_OCInitStructure.TIM_Pulse = 800;

	TIM_OC1Init(TIM4, &TIM_OCInitStructure);
	TIM_OC1PreloadConfig(TIM4, TIM_OCPreload_Enable);

	/* TIM2 Time base configuration, same as TIM4 */
	TIM_TimeBaseInit(TIM2, &TIM_TimeBaseStructure);

	/* TIM2 Output Compare Timing Mode configuration: Channel1 */
	TIM_OCInitStructure.TIM_OCMode = TIM_OCMode_Timing;
	TIM_OCInitStructure.TIM_OutputState = TIM_OutputState_Enable;
	TIM_OCInitStructure.TIM_Pulse = 820;
	TIM_OCInitStructure.TIM_OCPolarity = TIM_OCPolarity_High;

	TIM_OC1Init(TIM2, &TIM_OCInitStructure);
	TIM_OC1PreloadConfig(TIM2, TIM_OCPreload_Disable);

	/* TIM2 Output Compare Timing Mode configuration: Channel2 */
	TIM_OCInitStructure.TIM_Pulse = 1053;

	TIM_OC2Init(TIM2, &TIM_OCInitStructure);
	TIM_OC2PreloadConfig(TIM2, TIM_OCPreload_Disable);

	/* TIM4 trigger source */
	TIM_SelectInputTrigger(TIM4, TIM_TS_ITR2);
	TIM_SelectSlaveMode(TIM4, TIM_SlaveMode_External1);

	/* TIM2 trigger source */
	TIM_SelectInputTrigger(TIM2, TIM_TS_ITR2);
	TIM_SelectSlaveMode(TIM2, TIM_SlaveMode_External1);

	/* TIM2 Interrupts enable */
	TIM_ITConfig(TIM2, TIM_IT_CC1 | TIM_IT_CC2, ENABLE);
}


#ifdef  USE_FULL_ASSERT

/**
  * @brief  Reports the name of the source file and the source line number
  *         where the assert_param error has occurred.
  * @param  file: pointer to the source file name
  * @param  line: assert_param error line source number
  * @retval None
  */
void assert_failed(uint8_t* file, uint32_t line)
{
  /* User can add his own implementation to report the file name and line number,
     ex: printf("Wrong parameters value: file %s on line %d\r\n", file, line) */

  while (1)
  {}
}
#endif

/**
  * @}
  */ 

/**
  * @}
  */ 




